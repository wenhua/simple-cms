(function() {

  require('./zappa')(function() {
    this.enable('serve jquery');
    this.get({
      '/': function() {
        return this.render({
          index: {
            layout: false
          }
        });
      }
    });
    this.on({
      'set nickname': function() {
        return this.client.nickname = this.data.nickname;
      }
    });
    this.on({
      said: function() {
        this.broadcast({
          said: {
            nickname: this.client.nickname,
            text: this.data.text
          }
        });
        return this.emit({
          said: {
            nickname: this.client.nickname,
            text: this.data.text
          }
        });
      }
    });
    this.client({
      '/index.js': function() {
        var _this = this;
        this.connect();
        this.on({
          said: function() {
            return $('#panel').append("<p>" + this.data.nickname + " said: " + this.data.text + "</p>");
          }
        });
        return $(function() {
          _this.emit({
            'set nickname': {
              nickname: prompt('Pick a nickname!')
            }
          });
          $('#box').focus();
          return $('button').click(function(e) {
            _this.emit({
              said: {
                text: $('#box').val()
              }
            });
            $('#box').val('').focus();
            return e.preventDefault();
          });
        });
      }
    });
    return this.view({
      index: function() {
        doctype(5);
        return html(function() {
          head(function() {
            title('PicoChat!');
            script({
              src: '/socket.io/socket.io.js'
            });
            script({
              src: '/zappa/jquery.js'
            });
            script({
              src: '/zappa/zappa.js'
            });
            return script({
              src: '/index.js'
            });
          });
          return body(function() {
            div({
              id: 'panel'
            });
            return form(function() {
              input({
                id: 'box'
              });
              return button('Send');
            });
          });
        });
      }
    });
  });

}).call(this);
